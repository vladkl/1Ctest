<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"><html><head><meta content="text/html; charset=utf-8" http-equiv="Content-Type"></meta><link rel="stylesheet" type="text/css" href="__STYLE__"></link><meta name="GENERATOR" content="MSHTML 11.00.9600.18792"></meta></head><body>
<h1>Трассировки Microsoft SQL Server</h1>
<dl><dt>Содержание 
</dt><dd><a href="#trace_local">Локальный каталог трассировки</a> 
<dd><a href="#sql">Microsoft SQL Server</a> </dd></dd></dl><p>Выполнение следующей инструкции необходимо в случае использования аналитического показателя "Анализ взаимоблокировок", а также в случае использования аналитического показателя "Анализ ожиданий на блокировках", если включен режим сбора информации о гранулярности блокировок.</p>
<h2>Локальный каталог трассировки</h2>
<p>Локальный каталог трассировки - произвольный каталог на компьютере, где запущен Microsoft SQL Server. Пользователь, от имени которого запущен Microsoft SQL Server должен иметь права чтения и записи в каталог трассировки. В качестве локального каталога трассировки, можно использовать каталог временных файлов. Если это будет каталог временных файлов пользователя, от имени которого запущен Microsoft SQL Server, то настройка прав не требуется, т.к. в этом случае, все необходимые права уже есть.</p>
<h2 id="sql">Microsoft SQL Server</h2>
<p>Для пользователя, от имени которого запущены рабочие процессы кластера ЦУП должны быть настроены права доступа к Microsoft SQL Server и выданы разрешения работы с трассировками, в соответствии с нижеприведенной инструкцией.</p>
<p>1. Откройте SQL Server Management Studio и подключитесь к Microsoft SQL Server, на котором находится база данных исследуемой информационной базы.</p>
<p>2. Перейдите в раздел "&lt;Instance&gt;\Security\Logins" и создайте новый логин для пользователя от имени которого запускается ЦУП:</p>
<p><img src="_files/New login.png"></img></p>
<p>3. В открывшемся окне на странице "General" укажите имя настраиваемого пользователя операционной системы (при использовании Windows-аутентификации) или имя и пароль пользователя SQL Server'а (при использовании SQL Server аутентификации):</p>
<p><img src="_files/Настройка логина SQL Server.png"></img></p>
<p>4. Откройте свойства SQL Server:</p>
<p><img src="_files/SQLProp.png"></img></p>
<p>5. На странице "Permissions", для созданного логина, установите разрешение "Alter trace":</p>
<p><img src="_files/Alter Trace.png"></img></p>
<p>Данная настройка позволяет учетной записи, от имени которой подключается ЦУП, включать сбор трассировок на уровне сервера СУБД.</p>
<p>6. В случае если включен сбор информации о гранулярности блокировок, дополнительно необходимо установить разрешения "Connect any database" и "View any definition":</p>
<p><img src="_files/Connect any database.png"></img></p>
<p> <img src="_files/View any definition.png"></img></p>
<p>Включение этих разрешений позволяет учетной записи, от имени которой подключается ЦУП, получать информацию о структуре таблиц базы данных на уровне сервера СУБД (доступ к данным таблиц при такой настройке не предоставляется).</p>
<p>7. При использовании доменной аутентификации необходимо дополнительно настроить права доступа учетной записи Windows к серверу СУБД. Для этого на компьютере, где запускается SQL Server, добавьте пользователей, от имени которых запускаются рабочие процессы кластера базы ЦУП, в группу "SQLServerMSSQLUser$&lt;SERVERNAME&gt;$&lt;INSTANCENAME&gt;":</p>
<p><img src="_files/UserGroup.png"></img></p></body></html>