<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"><html><head><meta content="text/html; charset=utf-8" http-equiv="Content-Type"></meta><link rel="stylesheet" type="text/css" href="v8help://service_book/service_style"></link><meta name="GENERATOR" content="MSHTML 11.00.9600.18639"></meta></head><body>
<h1>Список ожиданий на блокировках</h1>
<p>Список ожиданий на блокировках представляет собой два связанных списка.</p>
<p>Первый список – группы ожиданий. Ожидания группируются по полному совпадению трех полей:</p>
<ul><li>строка кода, из которой был выполнен заблокированный запрос; 
</li><li>строка кода, из которой был выполнен блокирующий запрос; 
</li><li>заблокированный ресурс.</li></ul><p><br></p>
<p>Каждая группа имеет следующие поля:</p>
<ul><li>вес ожидания (общий для группы); 
</li><li>типблокировки: 
<ul><li>Блокировка СУБД; 
</li><li>Блокировка 1С.</li></ul></li><li>Контекст заблокированного запроса; 
</li><li>Контекст блокирующего запроса; 
</li><li>Заблокированный ресурс в терминах метаданных; 
</li><li>Заблокированный ресурс в терминах СУБД.</li></ul><p><img src="038b5c85-fb1c-4082-9c4c-e69f8928bf3a_files/057 - ЦУП (анализ - ожидания).png"></img></p>
<p>Следует начинать анализ ожиданий на блокировках с группы, имеющей наибольший вес.</p>
<p>Второй список – заблокированные и блокирующие запросы, относящиеся к данной группе. Список запросов имеет следующие поля:</p>
<ul><li>время ожидания; 
</li><li>вес ожидания; 
</li><li>статус информации об ожидании: 
<ul><li>точная информация; 
</li><li>предположительная информация;</li></ul></li><li>данные по заблокированному запросу: 
<ul><li>пользователь, выполнивший запрос и его компьютер; 
</li><li>SQL-текст запроса;</li></ul></li><li>данные по блокирующему запросу: 
<ul><li>пользователь, выполнивший запрос и его компьютер; 
</li><li>SQL-текст запроса;</li></ul></li></ul><h2>«Предположительные» и «точные» блокировки</h2>
<p>ЦУП всегда точно определяет заблокированный запрос. Однако, блокирующий запрос и заблокированный ресурс не всегда могут быть определены однозначно. Причина такой неопределенности – природа блокировок. Блокировка устанавливается во время выполнения запроса, но снимается только по окончании транзакции. То есть, запрос, установивший блокировку, может закончить свою работу, но сама блокировка данных будет су-ществовать и после этого. При этом блокировка «знает», какой ресурс она блокирует, но «не знает», какой запрос ее установил.</p>
<p>При анализе информации о блокировках, ЦУП пытается максимально точно определить блокирующий запрос. Однако, однозначное соответствие удается найти не всегда. В этом случае ЦУП определяет несколько «подозреваемых» - запросов, которые теоретически могли бы быть блокирующими в данной ситуации. При этом ЦУП создает все возможные варианты для данного ожидания на блокировке и помечает их как «Предположительные». Если блокирующий запрос удалось установить однозначно, то ожидание будет помечено как «Точные данные». Следует учитывать этот факт при анализе информации по ожиданиям на блокировках.</p></body></html>